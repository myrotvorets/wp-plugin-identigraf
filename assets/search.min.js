(()=>{function e(t){var a=n[t];if(void 0!==a)return a.exports;var l=n[t]={exports:{}};return r[t](l,l.exports,e),l.exports}var t,r={237:(e,t,r)=>{function n(){return n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},n.apply(this,arguments)}function a(e){var t;let{children:r,className:a}=e,l=function(e,t){if(null==e)return{};var r,n,a={},l=Object.keys(e);for(n=0;n<l.length;n++)t.indexOf(r=l[n])>=0||(a[r]=e[r]);return a}(e,I);return a="object"!=typeof a?`mb-3 ${null!=(t=a)?t:""}`:a,Z().createElement("p",n({className:a},l),r)}function l({progress:e}){return isNaN(e)?null:Z().createElement("div",{className:"d-flex align-items-center mb-3"},(0,F.__)("Upload:","i8fjs")," ",Z().createElement("progress",{max:100,value:-1===e?void 0:e,className:"flex-grow-1 ms-1"})," ",-1!==e?Z().createElement("span",{className:"ms-1"},e.toFixed(2),"%"):void 0)}function s(e){const t=B[e.code];return null!=t?t:e.message}function c(){const[e,t]=(0,N.useState)(""),[r,n]=(0,N.useState)(""),[c,i]=(0,N.useState)(""),[o,u]=(0,N.useState)(30),[m,f]=(0,N.useState)(void 0),{progress:d,error:p,response:h,finished:E}=z(`${self.i8f.iendpoint}/search`,m),g=(0,N.useCallback)((({currentTarget:e})=>{n("");const{files:r}=e,a=null==r?void 0:r[0];if(null!=a&&a.type.startsWith("image/")){const e=new FileReader;e.addEventListener("load",(({target:e})=>{t(e.result)})),e.readAsDataURL(a)}else t("")}),[]),v=(0,N.useCallback)((({currentTarget:e})=>{const t=e.valueAsNumber;u(t<5?5:t>100?100:t)}),[]),b=(0,N.useCallback)((t=>{t.preventDefault(),0!==e.length&&isNaN(d)&&f(new FormData(t.currentTarget))}),[e,d]);return(0,N.useEffect)((()=>n(p?(0,F.__)("Failed to upload the file","i8fjs"):"")),[p]),(0,N.useEffect)((()=>{if(E&&h)try{const e=JSON.parse(h.response);e.success?i(e.guid):n(401===h.status?(0,F.__)("Unexpected authentication error","i8fjs"):s(e))}catch(e){n((0,F.__)("Unknown error while analyzing the server response","i8fjs")),console.error(e)}}),[E,h]),""!==c?Z().createElement(x.Fg,{to:`/search/${c}`}):Z().createElement("section",{className:"d-flex flex-column w-100"},Z().createElement(C.Z,{as:"form",onSubmit:b},Z().createElement(C.Z.Body,null,r&&Z().createElement(O.Z,{variant:"danger"},r),Z().createElement(R.Z.Group,{controlId:"photo",className:"mb-3"},Z().createElement(R.Z.Label,null,(0,F.__)("Photo:","i8fjs")),Z().createElement(R.Z.Control,{type:"file",required:!0,accept:"image/png, image/jpeg",disabled:!isNaN(d),onChange:g,name:"photo"})),Z().createElement(R.Z.Group,{controlId:"minSimilarity",className:"mb-3"},Z().createElement(R.Z.Label,null,(0,F.__)("Minimum similarity:","i8fjs")),Z().createElement($.Z,null,Z().createElement(R.Z.Control,{type:"number",value:o,required:!0,name:"minSimilarity",min:5,max:80,onInput:v}),Z().createElement($.Z.Text,null,"%"))),e.length>0?Z().createElement(T.Z,{src:e,alt:(0,F.__)("Face to search","i8fjs"),className:"img-fluid mb-3"}):null,Z().createElement(l,{progress:d}),Z().createElement(a,null,Z().createElement(A.Z,{variant:"primary",type:"submit",disabled:0===e.length||!isNaN(d)},(0,F.__)("Submit","i8fjs"))))))}function i(){return i=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i.apply(this,arguments)}function o(e){var t;let{children:r,className:n}=e,a=function(e,t){if(null==e)return{};var r,n,a={},l=Object.keys(e);for(n=0;n<l.length;n++)t.indexOf(r=l[n])>=0||(a[r]=e[r]);return a}(e,q);return n="object"!=typeof n?`text-bg-primary ${null!=(t=n)?t:""}`:n,Z().createElement(C.Z.Header,i({as:"header",className:n},a),Z().createElement("h2",{className:"my-0 h5"},r))}function u({text:e,width:t=100,justifyContent:r="center",alignItems:n="center"}){return Z().createElement("div",{className:`d-flex justify-content-${r} align-items-${n}`},Z().createElement("img",{src:W,alt:e?"":"Зачекайте…",width:t,className:"SmallLoader"}),e&&Z().createElement("span",{className:"px-2"},e))}function m(){return Z().createElement(C.Z,{className:"w-100"},Z().createElement(o,null,(0,F.__)("Processing the request","i8fjs")),Z().createElement(C.Z.Body,null,Z().createElement(u,{width:200,text:(0,F.__)("Please wait…","i8fjs"),justifyContent:"start"})))}function f(){return Z().createElement(C.Z,{className:"w-100"},Z().createElement(C.Z.Header,{as:"header",className:"text-bg-danger"},Z().createElement("h2",{className:"my-0 h5"},(0,F.__)("Nothing Found","i8fjs"))),Z().createElement(C.Z.Body,null,Z().createElement(C.Z.Text,null,(0,F.__)("Unfortunately, the system has failed to recognize any face on the photo.","i8fjs")),Z().createElement(A.Z,{variant:"primary",href:"#/"},(0,F.__)("Back to search.","i8fjs"))))}function d({minSimilarity:e,maxSimilarity:t,face:r}){return Z().createElement("div",{className:"d-flex flex-column position-sticky bg-white",style:{top:"2rem"}},Z().createElement(T.Z,{fluid:!0,rounded:!0,className:"mt-3",src:`data:image/jpeg;base64,${r}`,alt:""}),Z().createElement(a,{"aria-label":(0,F.__)("Similarity","i8fjs"),className:"text-center"},(0,F.sprintf)((0,F.__)("%1$d…%2$d%%","i8fjs"),e,t)))}function p({link:e,text:t,onClick:r}){const n=(0,N.useCallback)((e=>{e.preventDefault(),r(e.currentTarget.href)}),[r]);return e?Z().createElement("p",{className:"mb-1"},Z().createElement("a",{href:e,target:"_blank",rel:"noopener noreferrer",onClick:n},t)):null}function h({country:e,face:t,link:r,matchedPhoto:n,name:a,onClick:l,primaryPhoto:s,similarity:c}){return Z().createElement(G.Z.Item,null,Z().createElement(J.Z,null,Z().createElement(K.Z,null,Z().createElement("a",{href:null!=r?r:"#",target:"_blank",rel:"noopener noreferrer",className:"text-danger fw-bold text-decoration-none fs-3"},null!=a?a:(0,F.__)("Unknown person","i8fjs")))),Z().createElement(J.Z,null,Z().createElement(K.Z,{sm:"auto"},Z().createElement(T.Z,{fluid:!0,thumbnail:!0,src:`data:image/jpeg;base64,${t}`,className:"d-block mb-2",alt:(0,F.__)("Face","i8fjs")})),Z().createElement(K.Z,{sm:4},e&&Z().createElement("p",{className:"mb-1"},(0,F.sprintf)((0,F.__)("Country: %s","i8fjs"),e)),Z().createElement(p,{link:n,text:"Світлина, яка збіглась",onClick:l}),Z().createElement(p,{link:s,text:"Основна світлина",onClick:l}),Z().createElement("p",{className:"mb-1"},(0,F.sprintf)((0,F.__)("Similarity: %1$d%%","i8fjs"),c)))))}function E(){return E=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},E.apply(this,arguments)}function g({faceID:e,guid:t}){const[r,n]=(0,N.useState)([]),[a,l]=(0,N.useState)(""),[c,i]=(0,N.useState)(!1),[o,m]=(0,N.useState)(""),f=(0,N.useCallback)((e=>{m(e)}),[]),d=(0,N.useCallback)((()=>{m("")}),[]);return(0,N.useEffect)((()=>{(async()=>{const r=await H.getMatchedFaces(t,e);r.success?n(r.matches):l(s(r)),i(!0)})()}),[e,t]),c?a?Z().createElement(C.Z.Body,null,Z().createElement(O.Z,{variant:"danger"},(0,F.sprintf)((0,F.__)("Error loading faces: %s","i8fjs"),a)),";"):r.length?Z().createElement(Z().Fragment,null,Z().createElement(G.Z,{variant:"flush"},r.map(((e,t)=>Z().createElement(h,E({},e,{key:t,onClick:f}))))),o&&Z().createElement(Q.ZP,{open:!0,close:d,slides:[{src:o}],fullscreen:{auto:!1},plugins:[X.Z]})):Z().createElement(C.Z.Body,null,Z().createElement("strong",null,(0,F.__)("No matches","i8fjs"))):Z().createElement(C.Z.Body,null,Z().createElement(u,{text:(0,F.__)("Loading…","i8fjs"),justifyContent:"start"}))}function v({face:e,guid:t,index:r}){return Z().createElement(G.Z.Item,null,Z().createElement(J.Z,null,Z().createElement(K.Z,null,Z().createElement("h3",null,(0,F.sprintf)((0,F.__)("Face %d","i8fjs"),r+1)))),Z().createElement(J.Z,null,Z().createElement(K.Z,{md:2,className:"position-sticky bg-white",style:{zIndex:1e3,top:0}},Z().createElement(d,e)),Z().createElement(K.Z,null,Z().createElement(g,{faceID:e.faceID,guid:t}))))}function b({capturedFaces:e,guid:t}){return Z().createElement(C.Z,{className:"w-100"},Z().createElement(C.Z.Header,{as:"header",className:"text-bg-primary"},Z().createElement("h2",{className:"my-0 h5"},(0,F.__)("Search Results","i8fjs"))),Z().createElement(G.Z,{variant:"flush"},e.map(((e,r)=>Z().createElement(v,{face:e,index:r,key:e.faceID,guid:t})))),Z().createElement(C.Z.Footer,null,Z().createElement(A.Z,{variant:"primary",href:"#/"},(0,F.__)("New search","i8fjs"))))}function _({guid:e}){const[t,r]=(0,N.useState)(""),[n,a]=(0,N.useState)(0),[l,c]=(0,N.useState)(0),[i,o]=(0,N.useState)(null),u=(0,N.useCallback)((()=>{H.checkSearchStatus(e).then((e=>{e.success?"inprogress"===e.status?(c(Date.now()),a(3e3)):o(e.faces):r(s(e))}))}),[e]);return Y(u,n,l),t?Z().createElement(O.Z,{variant:"danger"},t):null===i?Z().createElement(m,null):0===i.length?Z().createElement(f,null):Z().createElement(b,{guid:e,capturedFaces:i})}function y(){const{guid:e}=(0,x.UO)();return Z().createElement(_,{guid:e})}function j(){const[e,t]=(0,N.useState)(""),[r,n]=(0,N.useState)(0),[a,l]=(0,N.useState)(0);return Y((()=>{H.getApiToken().then((()=>{t(""),l(Date.now()),n(3e5)})).catch((e=>{t(e.message),n(5e3),console.error(e)}))}),r,a),Z().createElement(k.Z,null,Z().createElement(S.UT,null,Z().createElement("h1",{className:"h2"},Z().createElement(S.rU,{to:"/",className:"text-decoration-none"},self.i8f.title)),e&&Z().createElement(O.Z,{variant:"danger"},e),M.value?Z().createElement(x.Z5,null,Z().createElement(x.AW,{path:"/search/:guid",element:Z().createElement(y,null)}),Z().createElement(x.AW,{path:"/",element:Z().createElement(c,null)})):Z().createElement(u,{justifyContent:"left",width:300})))}var N=r(7363),Z=r.n(N),w=r(7634),k=r(754),O=r(9079),x=r(4935),S=r(5783),C=r(4048),R=r(1840),$=r(2290),T=r(3169),A=r(7137);const F=wp.i18n,I=["children","className"],U=wp.apiFetch;var D=r.n(U),P=r(2450);const L=(0,P.td)(""),M=(0,P.Fl)((()=>""!==L.value)),B={AUTHORIZATION_FAILED:(0,F.__)("Authorization failed.","i8fjs"),AUTHORIZATION_REQUIRED:(0,F.__)("Not authorized to perform this action.","i8fjs"),BAD_GATEWAY:(0,F.__)("Error communicating with the server.","i8fjs"),COMM_ERROR:(0,F.__)("Error communicating with the server.","i8fjs"),UNKNOWN_ERROR:(0,F.__)("Unknown error.","i8fjs")};class H{static async getApiToken(){try{const e=await D()({path:"/identigraf/v2/token"});L.value=e.token}catch(e){throw new Error((0,F.__)("Error getting the authentication token","i8fjs"))}}static checkCompareStatus(e){return H.get(`/compare/${e}`,L.value)}static checkSearchStatus(e){return H.get(`/search/${e}`,L.value)}static getMatchedFaces(e,t){return H.get(`/search/${e}/matches/${t}/0/20`,L.value)}static get(e,t){return H.fetch(`${self.i8f.iendpoint}${e}`,{headers:{Accept:"application/json",Authorization:`Bearer ${t}`}})}static fetch(e,t){return fetch(e,t).then((e=>e.json())).catch(H.error502)}static error502(){return{success:!1,status:502,code:"COMM_ERROR",message:(0,F.__)("Error communicating with the server","i8fjs")}}}const z=(e,t)=>{const[r,n]=(0,N.useState)(NaN),[a,l]=(0,N.useState)(null),[s,c]=(0,N.useState)(null),[i,o]=(0,N.useState)(!1),u=(0,N.useCallback)((e=>{n(e.lengthComputable?e.loaded/e.total*100:-1)}),[]),m=(0,N.useCallback)((()=>{n(NaN),o(!0),l(new Error)}),[]),f=(0,N.useCallback)((e=>{const t=e.currentTarget,r=t.getAllResponseHeaders().trim().split(/[\n\r]+/),a={};r.forEach((e=>{var t;const r=e.split(": ",2),n=null!=(t=r[1])?t:"";a[r[0]]=n})),n(NaN),o(!0),c({response:t.responseText,status:t.status,url:t.responseURL,headers:a})}),[]);return(0,N.useEffect)((()=>{if(e&&t){const r=new XMLHttpRequest;r.upload.addEventListener("progress",u),r.addEventListener("error",m),r.addEventListener("load",f),r.open("POST",e),r.setRequestHeader("Authorization",`Bearer ${L.value}`),r.send(t)}}),[t,m,f,u,e]),{progress:r,error:a,response:s,finished:i}},q=["children","className"],W=r.p+"identigraf-logo.77e00.svg";var G=r(4007),J=r(3738),K=r(7231),Q=r(5263),X=r(3364);r(6998);const Y=(e,t,r)=>{const n=(0,N.useRef)(e);(0,N.useEffect)((()=>{n.current=e}),[e]),(0,N.useEffect)((()=>{if(void 0===t)return;const e=self.setTimeout(n.current,t);return()=>{self.clearTimeout(e)}}),[t,r])},V=document.querySelector(".wrap");(0,w.s)(null!=V?V:document.body).render(Z().createElement(Z().StrictMode,null,Z().createElement(j,null)))},7363:e=>{e.exports=React},1533:e=>{e.exports=ReactDOM}},n={};e.m=r,t=[],e.O=(r,n,a,l)=>{if(!n){var s=1/0;for(u=0;u<t.length;u++){for(var[n,a,l]=t[u],c=!0,i=0;i<n.length;i++)(!1&l||s>=l)&&Object.keys(e.O).every((t=>e.O[t](n[i])))?n.splice(i--,1):(c=!1,l<s&&(s=l));if(c){t.splice(u--,1);var o=a();void 0!==o&&(r=o)}}return r}l=l||0;for(var u=t.length;u>0&&t[u-1][2]>l;u--)t[u]=t[u-1];t[u]=[n,a,l]},e.n=t=>{var r=t&&t.__esModule?()=>t.default:()=>t;return e.d(r,{a:r}),r},e.d=(t,r)=>{for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),e.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e.j=464,(()=>{var t;if("string"==typeof import.meta.url&&(t=import.meta.url),!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),e.p=t})(),(()=>{var t={464:0,723:0};e.O.j=e=>0===t[e];var r=(r,n)=>{var a,l,[s,c,i]=n,o=0;if(s.some((e=>0!==t[e]))){for(a in c)e.o(c,a)&&(e.m[a]=c[a]);if(i)var u=i(e)}for(r&&r(n);o<s.length;o++)e.o(t,l=s[o])&&t[l]&&t[l][0](),t[l]=0;return e.O(u)},n=self.webpackChunk=self.webpackChunk||[];n.forEach(r.bind(null,0)),n.push=r.bind(null,n.push.bind(n))})();var a=e.O(void 0,[251],(()=>e(237)));a=e.O(a)})();