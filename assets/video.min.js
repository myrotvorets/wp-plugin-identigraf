(()=>{function e(t){var i=n[t];if(void 0!==i)return i.exports;var s=n[t]={exports:{}};return r[t](s,s.exports,e),s.exports}var t,r={9228:(e,t,r)=>{function n({progress:e}){return null==e?null:a().createElement("div",{className:"d-flex align-items-center mb-3"},(0,_.__)("Upload:","i8fjs"),a().createElement(T.Z,{now:-1===e?100:e,striped:-1===e,animated:!0,className:"flex-fill mx-1"}),-1!==e?a().createElement("span",null,e.toFixed(2),"%"):void 0)}function i({video:e}){return e.length>0?a().createElement("video",{src:e,className:"mb-3",controls:!0}):null}var s=r(7363),a=r.n(s),o=r(7634),l=r(754),c=r(1262),u=r(8662),d=r(5783),m=r(4935);const h=(0,s.createContext)({token:""}),p=wp.apiFetch;var f=r.n(p);const _=wp.i18n,E={AUTHORIZATION_FAILED:(0,_.__)("Authorization failed.","i8fjs"),AUTHORIZATION_REQUIRED:(0,_.__)("Not authorized to perform this action.","i8fjs"),BAD_GATEWAY:(0,_.__)("Error communicating with the server.","i8fjs"),COMM_ERROR:(0,_.__)("Error communicating with the server.","i8fjs"),UNKNOWN_ERROR:(0,_.__)("Unknown error.","i8fjs")};class g{static getApiToken(){return f()({path:"/identigraf/v2/token"}).then((e=>e.token)).catch((()=>{throw new Error((0,_.__)("Error getting the authentication token","i8fjs"))}))}static checkCompareStatus(e,t){return g.get(`/compare/${e}`,t)}static checkSearchStatus(e,t){return g.get(`/search/${e}`,t)}static getMatchedFaces(e,t,r){return g.get(`/search/${e}/matches/${t}/0/20`,r)}static get(e,t){return g.fetch(`${self.i8f.iendpoint}${e}`,{headers:{Accept:"application/json",Authorization:`Bearer ${t}`}})}static fetch(e,t){return fetch(e,t).then((e=>e.json())).catch(g.error502)}static error502(){return{success:!1,status:502,code:"COMM_ERROR",message:(0,_.__)("Error communicating with the server","i8fjs")}}}var v=r(1840),b=r(8373),y=r(3738),S=r(7231),j=r(7137),T=r(6364);const w=({children:e})=>e?a().createElement("p",{className:"mb-1"},e):null;class O extends s.Component{constructor(...e){super(...e),this.state={video:"",uploadProgress:null,error:null,guid:null,minSimilarity:0},this._onFileChange=({currentTarget:e})=>{this.setState({error:null,guid:null,video:""});const{files:t}=e,r=null==t?void 0:t[0];if(null!=r&&r.type.startsWith("video/")){const e=r.type,t=new FileReader;t.addEventListener("load",(({target:t})=>{const r=t.result;if(r){const t=new Blob([new Uint8Array(r)],{type:e});this.setState({video:URL.createObjectURL(t)})}})),t.readAsArrayBuffer(r)}},this._onFormSubmit=e=>{e.preventDefault();const t=new FormData(e.currentTarget);t.delete("minsimilarity"),this.setState({uploadProgress:0,error:null});const r=this.context.token,n=new XMLHttpRequest;n.upload.addEventListener("progress",this._onUploadProgress),n.addEventListener("error",this._onUploadFailed),n.addEventListener("abort",this._onUploadAborted),n.addEventListener("timeout",this._onUploadTimeout),n.addEventListener("load",this._onUploadSucceeded),n.open("POST",`${self.i8f.vendpoint}/process`),n.setRequestHeader("Authorization",`Bearer ${r}`),n.send(t)},this._onUploadProgress=e=>{this.setState({uploadProgress:e.lengthComputable?e.loaded/e.total*100:-1})},this._onUploadFailed=()=>{this._setError((0,_.__)("Failed to upload the file","i8fjs"))},this._onUploadTimeout=()=>{this._setError((0,_.__)("Request has timed out","i8fjs"))},this._onUploadAborted=()=>{this._setError((0,_.__)("Upload aborted","i8fjs"))},this._onUploadSucceeded=e=>{this.setState({uploadProgress:100});const t=e.currentTarget;try{const e=JSON.parse(t.responseText);e.success?f()({method:"POST",path:"/identigraf/v2/video-check",data:{guid:e.guid,minSimilarity:this.state.minSimilarity}}).then((()=>{this.setState({guid:e.guid,video:"",uploadProgress:null})})).catch((()=>{this._setError((0,_.__)("Unexpected error","i8fjs"))})):this._setError(401===t.status?(0,_.__)("Unexpected authentication error","i8fjs"):function(e){const t=E[e.code];return null!=t?t:e.message}(e))}catch(e){this._setError((0,_.__)("Unknown error while analyzing the server response","i8fjs"))}},this._onMinSimilarityChange=e=>{this.setState({minSimilarity:e.target.valueAsNumber})}}_setError(e){this.setState({uploadProgress:null,error:e})}render(){const{error:e,guid:t,minSimilarity:r,uploadProgress:s,video:o}=this.state;return a().createElement(v.Z,{encType:"multipart/form-data",onSubmit:this._onFormSubmit},e&&a().createElement(c.Z,{variant:"danger"},e),t&&a().createElement(c.Z,{variant:"success"},a().createElement(w,null,(0,_.__)("Video has been successfully uploaded.","i8fjs")),a().createElement(w,null,(0,_.sprintf)((0,_.__)("Video ID: %s","i8fjs"),t)),a().createElement(w,null,(0,_.__)("Results will be sent to your email address.","i8fjs"))),a().createElement(v.Z.Group,{controlId:"video",className:"mb-3"},a().createElement(v.Z.Label,null,(0,_.__)("Video","i8fjs")),a().createElement(v.Z.Control,{name:"video",type:"file",required:!0,accept:"video/*",disabled:null!==s,onChange:this._onFileChange})),a().createElement(v.Z.Group,{controlId:"minsimilarity",className:"mb-3"},a().createElement(v.Z.Label,null,(0,_.__)("Minimum similarity","i8fj")),a().createElement(b.Z,{className:"mb-3"},a().createElement(v.Z.Control,{name:"minsimilarity",type:"number",min:0,max:100,required:!0,value:r,onChange:this._onMinSimilarityChange}),a().createElement(b.Z.Text,null,"%"))),a().createElement(y.Z,null,a().createElement(S.Z,null,a().createElement(i,{video:o}))),a().createElement(n,{progress:s}),a().createElement(j.Z,{variant:"primary",type:"submit"},(0,_.__)("Submit","i8fjs")))}}O.contextType=h;class U extends s.Component{constructor(...e){super(...e),this.state={error:null,ctx:{token:""}},this._timerId=0,this.refreshToken=()=>{g.getApiToken().then((e=>{this.setState({ctx:{token:e},error:null}),this._timerId=self.setTimeout(this.refreshToken,3e5)})).catch((e=>{this.setState({error:e.message}),this._timerId=self.setTimeout(this.refreshToken,3e5)}))}}componentDidMount(){this.refreshToken()}componentWillUnmount(){this._timerId>0&&self.clearTimeout(this._timerId)}render(){const{ctx:e,error:t}=this.state;return a().createElement(l.Z,null,a().createElement(d.UT,null,a().createElement("h1",{className:"h2"},a().createElement(d.rU,{to:"/",className:"text-decoration-none"},self.i8f.title)),t&&a().createElement(c.Z,{variant:"danger"},t),e.token?a().createElement(h.Provider,{value:e},a().createElement(m.Z5,null,a().createElement(m.AW,{path:"/",element:a().createElement(O,null)}))):a().createElement(u.Z,{animation:"border",variant:"primary"})))}}const k=document.querySelector(".wrap");(0,o.s)(null!=k?k:document.body).render(a().createElement(a().StrictMode,null,a().createElement(U,null)))},7363:e=>{e.exports=React},1533:e=>{e.exports=ReactDOM}},n={};e.m=r,t=[],e.O=(r,n,i,s)=>{if(!n){var a=1/0;for(u=0;u<t.length;u++){for(var[n,i,s]=t[u],o=!0,l=0;l<n.length;l++)(!1&s||a>=s)&&Object.keys(e.O).every((t=>e.O[t](n[l])))?n.splice(l--,1):(o=!1,s<a&&(a=s));if(o){t.splice(u--,1);var c=i();void 0!==c&&(r=c)}}return r}s=s||0;for(var u=t.length;u>0&&t[u-1][2]>s;u--)t[u]=t[u-1];t[u]=[n,i,s]},e.n=t=>{var r=t&&t.__esModule?()=>t.default:()=>t;return e.d(r,{a:r}),r},e.d=(t,r)=>{for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),e.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e.j=791,(()=>{var t={791:0};e.O.j=e=>0===t[e];var r=(r,n)=>{var i,s,[a,o,l]=n,c=0;if(a.some((e=>0!==t[e]))){for(i in o)e.o(o,i)&&(e.m[i]=o[i]);if(l)var u=l(e)}for(r&&r(n);c<a.length;c++)e.o(t,s=a[c])&&t[s]&&t[s][0](),t[s]=0;return e.O(u)},n=self.webpackChunk=self.webpackChunk||[];n.forEach(r.bind(null,0)),n.push=r.bind(null,n.push.bind(n))})();var i=e.O(void 0,[251],(()=>e(9228)));i=e.O(i)})();