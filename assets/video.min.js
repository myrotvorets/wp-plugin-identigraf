(()=>{function e(t){var a=n[t];if(void 0!==a)return a.exports;var s=n[t]={exports:{}};return r[t](s,s.exports,e),s.exports}var t,r={6166:(e,t,r)=>{function n({text:e,width:t=100,justifyContent:r="center",alignItems:n="center"}){return m().createElement("div",{className:`d-flex justify-content-${r} align-items-${n}`},m().createElement("img",{src:E,alt:e?"":"Зачекайте…",width:t,className:"SmallLoader"}),e&&m().createElement("span",{className:"px-2"},e))}function a(){return a=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},a.apply(this,arguments)}function s(e){var t;let{children:r,className:n}=e,s=function(e,t){if(null==e)return{};var r,n,a={},s=Object.keys(e);for(n=0;n<s.length;n++)t.indexOf(r=s[n])>=0||(a[r]=e[r]);return a}(e,S);return n="object"!=typeof n?`mb-3 ${null!=(t=n)?t:""}`:n,m().createElement("p",a({className:n},s),r)}function l({progress:e}){return isNaN(e)?null:m().createElement("div",{className:"d-flex align-items-center mb-3"},(0,R.__)("Upload:","i8fjs")," ",m().createElement("progress",{max:100,value:-1===e?void 0:e,className:"flex-grow-1 ms-1"})," ",-1!==e?m().createElement("span",{className:"ms-1"},e.toFixed(2),"%"):void 0)}function i({video:e}){return e.length>0?m().createElement("video",{src:e,className:"mb-3",controls:!0}):null}function o(){const[e,t]=(0,u.useState)(""),[r,n]=(0,u.useState)(""),[a,o]=(0,u.useState)(""),[c,f]=(0,u.useState)(0),[d,h]=(0,u.useState)(void 0),{progress:v,error:E,response:j,finished:S}=C(`${self.i8f.vendpoint}/process`,d),k=(0,u.useCallback)((({currentTarget:e})=>{n(""),t("");const{files:r}=e,a=null==r?void 0:r[0];if(null!=a&&a.type.startsWith("video/")){const e=a.type,r=new FileReader;r.addEventListener("load",(({target:r})=>{const n=r.result;if(n){const r=new Blob([new Uint8Array(n)],{type:e});t(URL.createObjectURL(r))}})),r.readAsArrayBuffer(a)}}),[]),x=(0,u.useCallback)((({currentTarget:e})=>{const t=e.valueAsNumber;f(t<0?0:t>100?100:t)}),[]),A=(0,u.useCallback)((t=>{if(t.preventDefault(),0!==e.length&&isNaN(v)){const e=new FormData(t.currentTarget);e.delete("minsimilarity"),h(e),n("")}}),[e,v]);return(0,u.useEffect)((()=>n(E?(0,R.__)("Failed to upload the file","i8fjs"):"")),[E]),(0,u.useEffect)((()=>{if(S&&j)try{const e=JSON.parse(j.response);e.success?O()({method:"POST",path:"/identigraf/v2/video-check",data:{guid:e.guid,minSimilarity:c}}).then((()=>{o(e.guid),t("")})).catch((()=>{n((0,R.__)("Unexpected error","i8fjs"))})):n(401===j.status?(0,R.__)("Unexpected authentication error","i8fjs"):function(e){const t=T[e.code];return null!=t?t:e.message}(e))}catch(e){n((0,R.__)("Unknown error while analyzing the server response","i8fjs")),console.error(e)}}),[S,c,j]),m().createElement("section",{className:"d-flex flex-column w-100"},m().createElement(g.Z,{as:"form",onSubmit:A},m().createElement(g.Z.Body,null,r&&m().createElement(p.Z,{variant:"danger"},r),a&&m().createElement(p.Z,{variant:"success"},m().createElement(s,null,(0,R.__)("Video has been successfully uploaded.","i8fjs")),m().createElement(s,null,(0,R.sprintf)((0,R.__)("Video ID: %s","i8fjs"),a)),m().createElement(s,null,(0,R.__)("Results will be sent to your email address.","i8fjs"))),m().createElement(b.Z.Group,{controlId:"video",className:"mb-3"},m().createElement(b.Z.Label,null,(0,R.__)("Video:","i8fjs")),m().createElement(b.Z.Control,{name:"video",type:"file",required:!0,accept:"video/*",disabled:!isNaN(v),onChange:k})),m().createElement(b.Z.Group,{controlId:"minsimilarity",className:"mb-3"},m().createElement(b.Z.Label,null,(0,R.__)("Minimum similarity:","i8fj")),m().createElement(_.Z,null,m().createElement(b.Z.Control,{name:"minsimilarity",type:"number",min:0,max:100,required:!0,value:c,onChange:x}),m().createElement(_.Z.Text,null,"%"))),m().createElement(y.Z,null,m().createElement(w.Z,null,m().createElement(i,{video:e}))),m().createElement(l,{progress:v}),m().createElement(s,null,m().createElement(N.Z,{variant:"primary",type:"submit",disabled:0===e.length||!isNaN(v)},(0,R.__)("Submit","i8fjs"))))))}function c(){const[e,t]=(0,u.useState)(""),[r,a]=(0,u.useState)(0),[s,l]=(0,u.useState)(0);return((e,t,r)=>{const n=(0,u.useRef)(e);(0,u.useEffect)((()=>{n.current=e}),[e]),(0,u.useEffect)((()=>{if(void 0===t)return;const e=self.setTimeout(n.current,t);return()=>{self.clearTimeout(e)}}),[t,r])})((()=>{Z.getApiToken().then((()=>{t(""),l(Date.now()),a(3e5)})).catch((e=>{t(e.message),a(5e3),console.error(e)}))}),r,s),m().createElement(d.Z,null,m().createElement(h.UT,null,m().createElement("h1",{className:"h2"},m().createElement(h.rU,{to:"/",className:"text-decoration-none"},self.i8f.title)),e&&m().createElement(p.Z,{variant:"danger"},e),A.value?m().createElement(v.Z5,null,m().createElement(v.AW,{path:"/",element:m().createElement(o,null)})):m().createElement(n,{justifyContent:"left",width:300})))}var u=r(7363),m=r.n(u),f=r(7634),d=r(754),p=r(9079),h=r(5783),v=r(4935);const E=r.p+"identigraf-logo.77e00.svg";var g=r(4048),b=r(1840),_=r(2290),y=r(3738),w=r(7231),N=r(7137);const j=wp.apiFetch;var O=r.n(j);const R=wp.i18n,S=["children","className"];var k=r(2450);const x=(0,k.td)(""),A=(0,k.Fl)((()=>""!==x.value)),T={AUTHORIZATION_FAILED:(0,R.__)("Authorization failed.","i8fjs"),AUTHORIZATION_REQUIRED:(0,R.__)("Not authorized to perform this action.","i8fjs"),BAD_GATEWAY:(0,R.__)("Error communicating with the server.","i8fjs"),COMM_ERROR:(0,R.__)("Error communicating with the server.","i8fjs"),UNKNOWN_ERROR:(0,R.__)("Unknown error.","i8fjs")};class Z{static async getApiToken(){try{const e=await O()({path:"/identigraf/v2/token"});x.value=e.token}catch(e){throw new Error((0,R.__)("Error getting the authentication token","i8fjs"))}}static checkCompareStatus(e){return Z.get(`/compare/${e}`,x.value)}static checkSearchStatus(e){return Z.get(`/search/${e}`,x.value)}static getMatchedFaces(e,t){return Z.get(`/search/${e}/matches/${t}/0/20`,x.value)}static get(e,t){return Z.fetch(`${self.i8f.iendpoint}${e}`,{headers:{Accept:"application/json",Authorization:`Bearer ${t}`}})}static fetch(e,t){return fetch(e,t).then((e=>e.json())).catch(Z.error502)}static error502(){return{success:!1,status:502,code:"COMM_ERROR",message:(0,R.__)("Error communicating with the server","i8fjs")}}}const C=(e,t)=>{const[r,n]=(0,u.useState)(NaN),[a,s]=(0,u.useState)(null),[l,i]=(0,u.useState)(null),[o,c]=(0,u.useState)(!1),m=(0,u.useCallback)((e=>{n(e.lengthComputable?e.loaded/e.total*100:-1)}),[]),f=(0,u.useCallback)((()=>{n(NaN),c(!0),s(new Error)}),[]),d=(0,u.useCallback)((e=>{const t=e.currentTarget,r=t.getAllResponseHeaders().trim().split(/[\n\r]+/),a={};r.forEach((e=>{var t;const r=e.split(": ",2),n=null!=(t=r[1])?t:"";a[r[0]]=n})),n(NaN),c(!0),i({response:t.responseText,status:t.status,url:t.responseURL,headers:a})}),[]);return(0,u.useEffect)((()=>{if(e&&t){const r=new XMLHttpRequest;r.upload.addEventListener("progress",m),r.addEventListener("error",f),r.addEventListener("load",d),r.open("POST",e),r.setRequestHeader("Authorization",`Bearer ${x.value}`),r.send(t)}}),[t,f,d,m,e]),{progress:r,error:a,response:l,finished:o}},U=document.querySelector(".wrap");(0,f.s)(null!=U?U:document.body).render(m().createElement(m().StrictMode,null,m().createElement(c,null)))},7363:e=>{e.exports=React},1533:e=>{e.exports=ReactDOM}},n={};e.m=r,t=[],e.O=(r,n,a,s)=>{if(!n){var l=1/0;for(u=0;u<t.length;u++){for(var[n,a,s]=t[u],i=!0,o=0;o<n.length;o++)(!1&s||l>=s)&&Object.keys(e.O).every((t=>e.O[t](n[o])))?n.splice(o--,1):(i=!1,s<l&&(l=s));if(i){t.splice(u--,1);var c=a();void 0!==c&&(r=c)}}return r}s=s||0;for(var u=t.length;u>0&&t[u-1][2]>s;u--)t[u]=t[u-1];t[u]=[n,a,s]},e.n=t=>{var r=t&&t.__esModule?()=>t.default:()=>t;return e.d(r,{a:r}),r},e.d=(t,r)=>{for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),e.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e.j=791,(()=>{var t;if("string"==typeof import.meta.url&&(t=import.meta.url),!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),e.p=t})(),(()=>{var t={791:0};e.O.j=e=>0===t[e];var r=(r,n)=>{var a,s,[l,i,o]=n,c=0;if(l.some((e=>0!==t[e]))){for(a in i)e.o(i,a)&&(e.m[a]=i[a]);if(o)var u=o(e)}for(r&&r(n);c<l.length;c++)e.o(t,s=l[c])&&t[s]&&t[s][0](),t[s]=0;return e.O(u)},n=self.webpackChunk=self.webpackChunk||[];n.forEach(r.bind(null,0)),n.push=r.bind(null,n.push.bind(n))})();var a=e.O(void 0,[251],(()=>e(6166)));a=e.O(a)})();