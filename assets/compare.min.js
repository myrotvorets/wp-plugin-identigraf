(()=>{function e(t){var n=a[t];if(void 0!==n)return n.exports;var s=a[t]={exports:{}};return r[t](s,s.exports,e),s.exports}var t,r={3702:(e,t,r)=>{function a(){return a=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e},a.apply(this,arguments)}function n(e){var t;let{children:r,className:n}=e,s=function(e,t){if(null==e)return{};var r,a,n={},s=Object.keys(e);for(a=0;a<s.length;a++)t.indexOf(r=s[a])>=0||(n[r]=e[r]);return n}(e,S);return n="object"!=typeof n?`text-bg-primary ${null!=(t=n)?t:""}`:n,v().createElement(w.Z.Header,a({as:"header",className:n},s),v().createElement("h2",{className:"my-0 h5"},r))}function s(){return s=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e},s.apply(this,arguments)}function l(e){var t;let{children:r,className:a}=e,n=function(e,t){if(null==e)return{};var r,a,n={},s=Object.keys(e);for(a=0;a<s.length;a++)t.indexOf(r=s[a])>=0||(n[r]=e[r]);return n}(e,k);return a="object"!=typeof a?`mb-3 ${null!=(t=a)?t:""}`:a,v().createElement("p",s({className:a},n),r)}function o({progress:e}){return isNaN(e)?null:v().createElement("div",{className:"d-flex align-items-center mb-3"},(0,x.__)("Upload:","i8fjs")," ",v().createElement("progress",{max:100,value:-1===e?void 0:e,className:"flex-grow-1 ms-1"})," ",-1!==e?v().createElement("span",{className:"ms-1"},e.toFixed(2),"%"):void 0)}function c(e){const t=U[e.code];return null!=t?t:e.message}function i(){const[e,t]=(0,E.useState)(""),[r,a]=(0,E.useState)(void 0),[s,i]=(0,E.useState)(!1),[u,m]=(0,E.useState)(!1),[f,p]=(0,E.useState)(""),{progress:d,error:h,response:g,finished:_}=I(`${self.i8f.iendpoint}/compare`,r),b=(0,E.useCallback)((({currentTarget:e})=>{const{files:t,id:r}=e,a=null!==t&&t.length>0;"photo1"===r?i(a):"photo2"===r&&m(a)}),[]),N=(0,E.useCallback)((e=>{e.preventDefault(),s&&u&&isNaN(d)&&a(new FormData(e.currentTarget))}),[s,u,d]);return(0,E.useEffect)((()=>t(h?(0,x.__)("Failed to upload the file","i8fjs"):"")),[h]),(0,E.useEffect)((()=>{if(_&&g)try{const e=JSON.parse(g.response);e.success?p(e.guid):t(401===g.status?(0,x.__)("Unexpected authentication error","i8fjs"):c(e))}catch(e){t((0,x.__)("Unknown error while analyzing the server response","i8fjs")),console.error(e)}}),[_,g]),""!==f?v().createElement(y.Fg,{to:`/compare/${f}`}):v().createElement("section",{className:"d-flex flex-column w-100"},v().createElement(w.Z,{as:"form",onSubmit:N},v().createElement(n,null,(0,x.__)("Compare","i8fjs")),v().createElement(w.Z.Body,null,e&&v().createElement(j.Z,{variant:"danger"},e),v().createElement(O.Z.Group,{controlId:"photo1",className:"mb-3"},v().createElement(O.Z.Label,null,(0,x.__)("Compared photo:","i8fjs")),v().createElement(O.Z.Control,{name:"photos",type:"file",required:!0,accept:"image/png, image/jpeg",disabled:!isNaN(d),onChange:b})),v().createElement(O.Z.Group,{controlId:"photo2",className:"mb-3"},v().createElement(O.Z.Label,null,(0,x.__)("Reference photos (up to 10 files):","i8fjs")),v().createElement(O.Z.Control,{name:"photos",type:"file",required:!0,multiple:!0,accept:"image/png, image/jpeg",disabled:!isNaN(d),onChange:b})),v().createElement(o,{progress:d}),v().createElement(l,null,v().createElement(Z.Z,{variant:"primary",type:"submit",disabled:!s||!u||!isNaN(d)},(0,x.__)("Submit","i8fjs"))))))}function u(){return v().createElement(w.Z,{className:"w-100"},v().createElement(w.Z.Header,{as:"header",className:"text-bg-danger"},v().createElement("h2",{className:"my-0 h5"},(0,x.__)("Comparison Results","i8fjs"))),v().createElement(w.Z.Body,null,v().createElement(w.Z.Text,{className:"text-danger"},(0,x.__)("Unfortunately, the system has failed to recognize any face, or the photo contains multiple faces","i8fjs")),v().createElement(Z.Z,{variant:"primary",href:"#/"},(0,x.__)("Back to comparison","i8fjs"))))}function m({guid:e,results:t}){const r=Object.values(t);return v().createElement(w.Z,{className:"w-100"},v().createElement(w.Z.Header,{className:"text-bg-primary"},(0,x.__)("Comparison Results","i8fjs")),v().createElement(w.Z.Body,null,v().createElement(F.Z,{fluid:!0,className:"d-block mx-auto mb-3",src:`${self.i8f.uendpoint}/get/${e}/0`,alt:(0,x.__)("Compared photo","i8fjs"),style:{maxHeight:"35vh"}}),v().createElement(L.Z,{interval:null,fade:!0,style:{height:"40vh"},className:"mb-3"},r.map(((t,r)=>v().createElement(L.Z.Item,{key:r},v().createElement(F.Z,{fluid:!0,className:"d-block mx-auto",src:`${self.i8f.uendpoint}/get/${e}/${r+1}`,alt:(0,x.sprintf)((0,x.__)("Photo %1$d","i8fjs"),r+1),style:{maxHeight:"35vh"}}),v().createElement(L.Z.Caption,null,v().createElement("strong",null,(0,x.__)("Similarity:","i8fjs"))," ",t,"%"))))),v().createElement(Z.Z,{variant:"primary",href:"#/"},(0,x.__)("New comparison","i8fjs"))))}function f({text:e,width:t=100,justifyContent:r="center",alignItems:a="center"}){return v().createElement("div",{className:`d-flex justify-content-${r} align-items-${a}`},v().createElement("img",{src:M,alt:e?"":"Зачекайте…",width:t,className:"SmallLoader"}),e&&v().createElement("span",{className:"px-2"},e))}function p(){return v().createElement(w.Z,{className:"w-100"},v().createElement(n,null,(0,x.__)("Processing the request","i8fjs")),v().createElement(w.Z.Body,null,v().createElement(f,{width:200,text:(0,x.__)("Please wait…","i8fjs"),justifyContent:"start"})))}function d({guid:e}){const[t,r]=(0,E.useState)(""),[a,n]=(0,E.useState)(0),[s,l]=(0,E.useState)(0),[o,i]=(0,E.useState)({}),[f,d]=(0,E.useState)(!1),h=(0,E.useCallback)((()=>{H.checkCompareStatus(e).then((e=>(e.success?"inprogress"===e.status?(l(Date.now()),n(3e3)):("complete"===e.status&&i(e.matches),d(!0)):r(c(e)),null)))}),[e]);return P(h,a,s),t?v().createElement(j.Z,{variant:"danger"},t):f?0===Object.keys(o).length?v().createElement(u,null):v().createElement(m,{guid:e,results:o}):v().createElement(p,null)}function h(){const{guid:e}=(0,y.UO)();return v().createElement(d,{guid:e})}function g(){const[e,t]=(0,E.useState)(""),[r,a]=(0,E.useState)(0),[n,s]=(0,E.useState)(0);return P((()=>{H.getApiToken().then((()=>{t(""),s(Date.now()),a(3e5)})).catch((e=>{t(e.message),a(5e3),console.error(e)}))}),r,n),v().createElement(b.Z,null,v().createElement(N.UT,null,v().createElement("h1",{className:"h2"},v().createElement(N.rU,{to:"/",className:"text-decoration-none"},self.i8f.title)),e&&v().createElement(j.Z,{variant:"danger"},e),T.value?v().createElement(y.Z5,null,v().createElement(y.AW,{path:"/compare/:guid",element:v().createElement(h,null)}),v().createElement(y.AW,{path:"/",element:v().createElement(i,null)})):v().createElement(f,{justifyContent:"left",width:300})))}var E=r(7363),v=r.n(E),_=r(7634),b=r(754),j=r(9079),y=r(4935),N=r(5783),w=r(4048),O=r(1840),Z=r(7137);const x=wp.i18n,S=["children","className"],k=["children","className"],C=wp.apiFetch;var R=r.n(C),$=r(2450);const A=(0,$.td)(""),T=(0,$.Fl)((()=>""!==A.value)),U={AUTHORIZATION_FAILED:(0,x.__)("Authorization failed.","i8fjs"),AUTHORIZATION_REQUIRED:(0,x.__)("Not authorized to perform this action.","i8fjs"),BAD_GATEWAY:(0,x.__)("Error communicating with the server.","i8fjs"),COMM_ERROR:(0,x.__)("Error communicating with the server.","i8fjs"),UNKNOWN_ERROR:(0,x.__)("Unknown error.","i8fjs")};class H{static async getApiToken(){try{const e=await R()({path:"/identigraf/v2/token"});A.value=e.token}catch(e){throw new Error((0,x.__)("Error getting the authentication token","i8fjs"))}}static checkCompareStatus(e){return H.get(`/compare/${e}`,A.value)}static checkSearchStatus(e){return H.get(`/search/${e}`,A.value)}static getMatchedFaces(e,t){return H.get(`/search/${e}/matches/${t}/0/20`,A.value)}static get(e,t){return H.fetch(`${self.i8f.iendpoint}${e}`,{headers:{Accept:"application/json",Authorization:`Bearer ${t}`}})}static fetch(e,t){return fetch(e,t).then((e=>e.json())).catch(H.error502)}static error502(){return{success:!1,status:502,code:"COMM_ERROR",message:(0,x.__)("Error communicating with the server","i8fjs")}}}const I=(e,t)=>{const[r,a]=(0,E.useState)(NaN),[n,s]=(0,E.useState)(null),[l,o]=(0,E.useState)(null),[c,i]=(0,E.useState)(!1),u=(0,E.useCallback)((e=>{a(e.lengthComputable?e.loaded/e.total*100:-1)}),[]),m=(0,E.useCallback)((()=>{a(NaN),i(!0),s(new Error)}),[]),f=(0,E.useCallback)((e=>{const t=e.currentTarget,r=t.getAllResponseHeaders().trim().split(/[\n\r]+/),n={};r.forEach((e=>{var t;const r=e.split(": ",2),a=null!=(t=r[1])?t:"";n[r[0]]=a})),a(NaN),i(!0),o({response:t.responseText,status:t.status,url:t.responseURL,headers:n})}),[]);return(0,E.useEffect)((()=>{if(e&&t){const r=new XMLHttpRequest;r.upload.addEventListener("progress",u),r.addEventListener("error",m),r.addEventListener("load",f),r.open("POST",e),r.setRequestHeader("Authorization",`Bearer ${A.value}`),r.send(t)}}),[t,m,f,u,e]),{progress:r,error:n,response:l,finished:c}};var F=r(3169),L=r(1288);const M=r.p+"identigraf-logo.5375e.svg",P=(e,t,r)=>{const a=(0,E.useRef)(e);(0,E.useEffect)((()=>{a.current=e}),[e]),(0,E.useEffect)((()=>{if(void 0===t)return;const e=self.setTimeout(a.current,t);return()=>{self.clearTimeout(e)}}),[t,r])},B=document.querySelector(".wrap");(0,_.s)(null!=B?B:document.body).render(v().createElement(v().StrictMode,null,v().createElement(g,null)))},7363:e=>{e.exports=React},1533:e=>{e.exports=ReactDOM}},a={};e.m=r,t=[],e.O=(r,a,n,s)=>{if(!a){var l=1/0;for(u=0;u<t.length;u++){for(var[a,n,s]=t[u],o=!0,c=0;c<a.length;c++)(!1&s||l>=s)&&Object.keys(e.O).every((t=>e.O[t](a[c])))?a.splice(c--,1):(o=!1,s<l&&(l=s));if(o){t.splice(u--,1);var i=n();void 0!==i&&(r=i)}}return r}s=s||0;for(var u=t.length;u>0&&t[u-1][2]>s;u--)t[u]=t[u-1];t[u]=[a,n,s]},e.n=t=>{var r=t&&t.__esModule?()=>t.default:()=>t;return e.d(r,{a:r}),r},e.d=(t,r)=>{for(var a in r)e.o(r,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:r[a]})},e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),e.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e.j=888,(()=>{var t;if("string"==typeof import.meta.url&&(t=import.meta.url),!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),e.p=t})(),(()=>{var t={888:0};e.O.j=e=>0===t[e];var r=(r,a)=>{var n,s,[l,o,c]=a,i=0;if(l.some((e=>0!==t[e]))){for(n in o)e.o(o,n)&&(e.m[n]=o[n]);if(c)var u=c(e)}for(r&&r(a);i<l.length;i++)e.o(t,s=l[i])&&t[s]&&t[s][0](),t[s]=0;return e.O(u)},a=self.webpackChunk=self.webpackChunk||[];a.forEach(r.bind(null,0)),a.push=r.bind(null,a.push.bind(a))})();var n=e.O(void 0,[251],(()=>e(3702)));n=e.O(n)})();